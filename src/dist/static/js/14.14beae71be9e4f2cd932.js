webpackJsonp([14],{"/t6J":function(e,t,i){"use strict";t.c=function(e){return Object(n.a)({url:"/system/GetAllSysRolePageList",method:"get",params:e})},t.a=function(e,t){var i="create"===t?"/System/AddSysRole":"/System/ModifySysRole";return Object(n.a)({url:i,method:"create"===t?"post":"put",data:e})},t.b=function(e){return Object(n.a)({url:"/system/DelSysRoleById",method:"delete",params:{id:e}})},t.d=function(){return Object(n.a)({url:"/system/getAllSysRoleList",method:"get"})};var n=i("vLgD")},aeOR:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("s3ol"),o=i("cAgV"),a=i("/t6J"),s=i("5ybE"),l=i("bUp0"),r=[{key:1,display_name:"正常"},{key:0,display_name:"停用"}],c={name:"roleList",components:{treeTable:n.a},directives:{waves:o.a},data:function(){return{menuData:[],menuIds:[],permissionIds:[],statusOptions:r,dialogStatus:"",textMap:{update:"Edit",create:"Create"},dialogFormVisible:!1,dialogAddOrModifyFormVisible:!1,tableKey:0,list:null,total:null,listLoading:!0,listLoadingtree:!0,listQuery:{pageIndex:1,pageSize:10,roleName:void 0,orgId:void 0},deptOptions:[],roleId:0,creatRolesForm:{roleId:0,roleName:void 0,orgId:void 0,description:void 0},rules:{description:[{min:0,max:200,message:"长度不能超过200个字符",trigger:"blur"}],roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"},{min:2,max:20,message:"长度在2到20个字符",trigger:"blur"}],orgId:[{required:!0,message:"所属部门不能为空",trigger:"change"}]},AddRole:!1,EditRole:!1,DeleteRole:!1,RolePermission:!1,IsSumbit:!1}},created:function(){var e=this;this.$store.dispatch("getPagePermission","roleList").then(function(t){e.AddRole=t.AddRole,e.EditRole=t.EditRole,e.DeleteRole=t.DeleteRole,e.RolePermission=t.RolePermission}),this.getDeptList(),this.getList()},computed:{},filters:{},methods:{deptConvert:function(e){var t=this.deptOptions.find(function(t){return t.key==e});if(t)return t.display_name},getDeptList:function(){var e=this;Object(s.c)().then(function(t){t.data.data.forEach(function(t){e.deptOptions.push({key:t.orgId,display_name:t.orgName})})})},getList:function(){var e=this;this.listLoading=!0,Object(a.c)(this.listQuery).then(function(t){e.list=t.data.data,e.total=t.data.total,e.listLoading=!1})},handleFilter:function(){this.listQuery.pageIndex=1,this.getList()},handleSizeChange:function(e){this.listQuery.pageSize=e,this.getList()},handleCurrentChange:function(e){this.listQuery.pageIndex=e,this.getList()},handleUpdate:function(e){var t=this;this.dialogStatus="update",this.creatRolesForm={roleId:e.roleId,roleName:e.roleName,orgId:e.orgId,description:e.description},this.dialogAddOrModifyFormVisible=!0,this.$nextTick(function(){t.$refs.creatRolesForm.clearValidate()})},handleCreate:function(){var e=this;this.creatRolesForm={roleId:0,roleName:void 0,orgId:void 0,description:void 0},this.dialogStatus="create",this.dialogAddOrModifyFormVisible=!0,this.$nextTick(function(){e.$refs.creatRolesForm.clearValidate()})},handleAllot:function(e){var t=this;this.roleId=e.roleId,this.dialogFormVisible=!0,this.menuData.length||Object(l.e)().then(function(i){t.listLoadingtree=!1,t.menuData=i.data.data,Object(l.e)(e.roleId).then(function(e){e.data.data.forEach(function(e){var i=t.menuData.find(function(t){return t.menuId==e.menuId});i.check=!0,e.children.forEach(function(e){var t=i.children.find(function(t){return t.menuId==e.menuId});t.check=!0,e.permission.forEach(function(e){t.permission.find(function(t){return t.permissionId==e.permissionId}).check=!0})})})})})},AddSumbit:function(e){var t=this;this.IsSumbit=!0,this.$refs.creatRolesForm.validate(function(i){i?Object(a.a)(t.creatRolesForm,e).then(function(e){e.data;t.dialogAddOrModifyFormVisible=!1,t.$notify({title:"成功",message:"操作成功",type:"success",duration:2e3}),t.handleFilter(),t.IsSumbit=!1}).catch(function(){t.IsSumbit=!1}):t.IsSumbit=!1})},handleDel:function(e){var t=this;this.$confirm("此操作将永久删除【"+e.roleName+"】, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(a.b)(e.roleId).then(function(){t.$message({type:"success",message:"删除成功!"}),t.handleFilter()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},menucheck:function(e){if(0==e.pMenuId)e.children&&e.children.forEach(function(t){t.check=e.check,t.permission.forEach(function(t){t.check=e.check})});else{e.permission.forEach(function(t){t.check=e.check});var t=this.menuData.find(function(t){return t.menuId==e.pMenuId});e.check?t.check=!0:0==t.children.filter(function(e){return e.check}).length&&(t.check=!1)}},permissioncheck:function(e,t,i){if(e.check){var n=this.menuData.find(function(e){return e.menuId==t}),o=n.children.find(function(e){return e.menuId==i});n.check=!0,o.check=!0}},removeNotCheckMenus:function(e){var t=this;e.check&&(this.menuIds.push(e.menuId),this.removeNotCheckPermissions(e.permission),e.children&&e.children.forEach(function(e){e.check&&t.removeNotCheckMenus(e)}))},removeNotCheckPermissions:function(e){var t=this;e.forEach(function(e){e.check&&t.permissionIds.push(e.permissionId)})},modifyPermissionSumbit:function(){var e=this;this.menuIds=[],this.permissionIds=[],this.menuData.forEach(function(t){e.removeNotCheckMenus(t)}),Object(l.b)(this.roleId,this.menuIds,this.permissionIds).then(function(){e.$message({type:"success",message:"授权成功!"}),e.handleFilter(),e.dialogFormVisible=!1})}}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container calendar-list-container"},[i("div",{staticClass:"filter-container"},[i("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"角色名称"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.handleFilter(t)}},model:{value:e.listQuery.roleName,callback:function(t){e.$set(e.listQuery,"roleName",t)},expression:"listQuery.roleName"}}),e._v(" "),i("el-select",{staticClass:"filter-item",staticStyle:{width:"130px"},attrs:{clearable:"",placeholder:"所属部门"},model:{value:e.listQuery.orgId,callback:function(t){e.$set(e.listQuery,"orgId",t)},expression:"listQuery.orgId"}},e._l(e.deptOptions,function(e){return i("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})})),e._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v(e._s(e.$t("table.search")))]),e._v(" "),e.AddRole?i("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleCreate}},[e._v(e._s(e.$t("table.add")))]):e._e()],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,"element-loading-text":"给我一点时间",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:e.$t("table.id"),width:"65"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.roleId))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"角色名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.roleName))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"所属部门"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.deptConvert(t.row.orgId)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.description))])]}}])}),e._v(" "),i("el-table-column",{staticStyle:{width:"100%"},attrs:{align:"center",label:e.$t("table.actions"),"class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.EditRole?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){e.handleUpdate(t.row)}}},[e._v(e._s(e.$t("table.edit")))]):e._e(),e._v(" "),e.RolePermission?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){e.handleAllot(t.row)}}},[e._v("授权")]):e._e(),e._v(" "),e.DeleteRole?i("el-button",{attrs:{size:"mini",icon:"el-icon-delete",type:"danger"},on:{click:function(i){e.handleDel(t.row)}}}):e._e()]}}])})],1),e._v(" "),i("div",{staticClass:"pagination-container"},[i("el-pagination",{attrs:{background:"","current-page":e.listQuery.pageIndex,"pageIndex-sizes":[10,20,30,50],"page-size":e.listQuery.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),i("el-dialog",{attrs:{width:"450px",title:e.textMap[e.dialogStatus],visible:e.dialogAddOrModifyFormVisible},on:{"update:visible":function(t){e.dialogAddOrModifyFormVisible=t}}},[i("el-form",{ref:"creatRolesForm",staticStyle:{"margin-left":"50px"},attrs:{rules:e.rules,model:e.creatRolesForm,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{autosize:"",placeholder:"Please input"},model:{value:e.creatRolesForm.roleName,callback:function(t){e.$set(e.creatRolesForm,"roleName",t)},expression:"creatRolesForm.roleName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"所属部门",prop:"orgId"}},[i("el-select",{staticClass:"filter-item",attrs:{autosize:"",placeholder:"Please select"},model:{value:e.creatRolesForm.orgId,callback:function(t){e.$set(e.creatRolesForm,"orgId",t)},expression:"creatRolesForm.orgId"}},e._l(e.deptOptions,function(e){return i("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"备注",prop:"description"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"Please input"},model:{value:e.creatRolesForm.description,callback:function(t){e.$set(e.creatRolesForm,"description",t)},expression:"creatRolesForm.description"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogAddOrModifyFormVisible=!1}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),i("el-button",{attrs:{type:"primary",disabled:e.IsSumbit},on:{click:function(t){e.AddSumbit(e.dialogStatus)}}},[e._v(e._s(e.$t("table.confirm")))])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"分配权限",fullscreen:this.isMobile,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("tree-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoadingtree,expression:"listLoadingtree"}],attrs:{data:e.menuData,border:""}},[i("el-table-column",{attrs:{width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-checkbox",{key:t.row.menuId,on:{change:function(i){e.menucheck(t.row)}},model:{value:t.row.check,callback:function(i){e.$set(t.row,"check",i)},expression:"scope.row.check"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"菜单名称",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.menuName))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"权限值"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.permission,function(n){return i("el-checkbox",{key:n.permissionId,on:{change:function(i){e.permissioncheck(n,t.row.pMenuId,t.row.menuId)}},model:{value:n.check,callback:function(t){e.$set(n,"check",t)},expression:"mpb.check"}},[e._v(e._s(n.permissionName))])})}}])})],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.modifyPermissionSumbit}},[e._v(e._s(e.$t("table.confirm")))])],1)],1)],1)},staticRenderFns:[]},u=i("VU/8")(c,d,!1,null,null,null);t.default=u.exports}});