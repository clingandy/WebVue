webpackJsonp([20],{x5bX:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("x3IM"),l={name:"addOrder",directives:{waves:r("cAgV").a},data:function(){return{queryName:void 0,loadingClient:!1,clientOptions:[],fullAddressOptions:[],orderStatusOptions:[],shippingTypeOptions:[],productTypeOptions:[],productNameTypeOptions:[],materialOptions:[],exteriorOptions:[],createOrder:{orderId:0,clientName:void 0,clientId:void 0,fullAddress:void 0,shippingType:void 0,shippingCode:void 0,freightPrice:void 0,status:void 0,totlaPrice:void 0,description:void 0},rules:{clientId:[{required:!0,message:"请选择正确的旺旺名称",trigger:"blur"}],status:[{required:!0,message:"状态不能为空",trigger:"blur"}],shippingType:[{required:!0,message:"快递不能为空",trigger:"blur"}],freightPrice:[{required:!0,message:"运费不能为空",trigger:"change"},{type:"number",message:"请输入数字格式",trigger:"blur",transform:function(e){return Number(e)}}],totlaPrice:[{required:!0,message:"总价格不能为空",trigger:"change"},{type:"number",message:"请输入数字格式",trigger:"blur",transform:function(e){return Number(e)}}],fullAddress:[{required:!0,message:"收货地址不能为空",trigger:"blur"}]}}},watch:{},created:function(){this.getOrderStatus(),this.getDictByType(1,this.productTypeOptions),this.getDictByType(2,this.productNameTypeOptions),this.getDictByType(3,this.materialOptions),this.getDictByType(4,this.exteriorOptions),this.getDictByType(5,this.shippingTypeOptions)},computed:{orderItems:function(){return this.$store.getters.orderItems}},methods:{getFileUrl:function(e){return"http://47.99.217.95:8091"+e},typeConvert:function(e,t){var r=t.find(function(t){return t.key==e});if(r)return r.value},changeBuyCount:function(e,t){e.buyTotalPrice=e.retailPrice*t},changeRetailPrice:function(e,t){e.buyTotalPrice=t*e.buyCount},selectAddress:function(e){this.createOrder.fullAddress=this.typeConvert(e,this.fullAddressOptions)},getProductFullName:function(e){return this.typeConvert(e.productType,this.productTypeOptions)+" "+this.typeConvert(e.productNameType,this.productNameTypeOptions)+" "+e.specification+" "+this.typeConvert(e.material,this.materialOptions)+" "+this.typeConvert(e.exterior,this.exteriorOptions)},getOrderStatus:function(){var e=this;Object(i.r)().then(function(t){e.orderStatusOptions=t.data.data})},getDictByType:function(e,t){Object(i.n)(e).then(function(e){e.data.data.forEach(function(e){t.push({key:e.key,value:e.value})})})},getClientAddress:function(e){var t=this;this.isMobile&&(this.createOrder.clientName=this.typeConvert(e,this.clientOptions)),this.fullAddressOptions=[],e&&Object(i.k)(e).then(function(e){e.data.data.forEach(function(e){t.fullAddressOptions.push({key:e.clientAddressId,value:e.fullAddress+" "+e.mobile})})})},getClientNameId:function(e){var t=this;e&&this.queryName!==e&&(this.queryName=e,this.loadingClient=!0,Object(i.l)(e).then(function(e){t.clientOptions=e.data.data,t.loadingClient=!1}))},createClientFilter:function(e){return function(t){return t.value.toLowerCase().indexOf(e.toLowerCase())>-1}},handleRemoveOrderItem:function(e){this.$store.dispatch("removeOrderItem",e.productId)},computeTotalPrice:function(){var e=0;this.orderItems.forEach(function(t){e+=t.buyTotalPrice}),e+=Number(this.createOrder.freightPrice),this.createOrder.totlaPrice=e},addSumbit:function(){var e=this;this.computeTotalPrice(),this.$refs.addOrderForm.validate(function(t){if(t){var r=[],l=!0;e.orderItems.forEach(function(t){e.validateOrderItem(t)||(l=!1),r.push({orderItemId:0,orderId:0,productId:t.productId,productFullName:e.getProductFullName(t),count:t.buyCount,singlePrice:t.retailPrice,totalPrice:t.buyTotalPrice,productUrl:t.buyProductUrl,imgUrl:t.imgUrl,weight:t.buyWeight})}),l&&Object(i.b)(e.createOrder,r).then(function(t){e.dialogFormVisible=!1,e.resetForm(),e.$notify({title:"成功",message:"操作成功",type:"success",duration:2e3})})}})},validateOrderItem:function(e){return e.buyCount>0&&e.retailPrice>0&&e.buyTotalPrice>1||(this.$message({message:"购买数量、单价必须大于0，总价必须大于1",type:"error",duration:5e3}),!1)},resetForm:function(){var e=this;this.$nextTick(function(){e.$refs.addOrderForm.clearValidate()}),this.createOrder={orderId:0,clientId:void 0,fullAddress:void 0,shippingType:void 0,shippingCode:void 0,freightPrice:void 0,status:void 0,totlaPrice:void 0,description:void 0},this.$store.dispatch("cleanOrderItem")}}},a={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container calendar-list-container"},[r("el-form",{ref:"addOrderForm",staticClass:"demo-form-inline",attrs:{rules:e.rules,model:e.createOrder,inline:!0,"label-position":"right","label-width":"100px"}},[r("div",[r("el-form-item",{attrs:{label:"旺旺名称",prop:"clientId"}},[this.isMobile?r("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入查询旺旺名称",clearable:""},on:{change:e.getClientNameId},model:{value:e.createOrder.clientName,callback:function(t){e.$set(e.createOrder,"clientName",t)},expression:"createOrder.clientName"}},[r("el-select",{staticClass:"filter-item",staticStyle:{width:"80px"},attrs:{slot:"prepend",placeholder:"选择"},on:{change:e.getClientAddress},slot:"prepend",model:{value:e.createOrder.clientId,callback:function(t){e.$set(e.createOrder,"clientId",t)},expression:"createOrder.clientId"}},e._l(e.clientOptions,function(e){return r("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))],1):r("el-select",{staticStyle:{width:"185px"},attrs:{clearable:"",filterable:"",remote:"",placeholder:"请输入旺旺名称","remote-method":e.getClientNameId,loading:e.loadingClient},on:{change:e.getClientAddress},model:{value:e.createOrder.clientId,callback:function(t){e.$set(e.createOrder,"clientId",t)},expression:"createOrder.clientId"}},e._l(e.clientOptions,function(e){return r("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"收货地址",prop:"fullAddress"}},[r("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入保存收货地址",clearable:""},model:{value:e.createOrder.fullAddress,callback:function(t){e.$set(e.createOrder,"fullAddress",t)},expression:"createOrder.fullAddress"}},[r("el-select",{staticClass:"filter-item",staticStyle:{width:"80px"},attrs:{slot:"prepend",placeholder:"选择"},on:{change:e.selectAddress},slot:"prepend",model:{value:e.createOrder.fullAddressId,callback:function(t){e.$set(e.createOrder,"fullAddressId",t)},expression:"createOrder.fullAddressId"}},e._l(e.fullAddressOptions,function(e){return r("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))],1)],1)],1),e._v(" "),r("div",[r("el-form-item",{attrs:{label:"物流类型",prop:"shippingType"}},[r("el-select",{staticClass:"filter-item",staticStyle:{width:"185px"},attrs:{placeholder:"Please select"},model:{value:e.createOrder.shippingType,callback:function(t){e.$set(e.createOrder,"shippingType",t)},expression:"createOrder.shippingType"}},e._l(e.shippingTypeOptions,function(e){return r("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"物流单号",prop:"shippingCode"}},[r("el-input",{attrs:{placeholder:"Please input"},model:{value:e.createOrder.shippingCode,callback:function(t){e.$set(e.createOrder,"shippingCode",t)},expression:"createOrder.shippingCode"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"运费",prop:"freightPrice"}},[r("el-input",{attrs:{placeholder:"Please input"},model:{value:e.createOrder.freightPrice,callback:function(t){e.$set(e.createOrder,"freightPrice",t)},expression:"createOrder.freightPrice"}})],1)],1),e._v(" "),r("div",[r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-select",{staticClass:"filter-item",staticStyle:{width:"185px"},attrs:{placeholder:"Please select"},model:{value:e.createOrder.status,callback:function(t){e.$set(e.createOrder,"status",t)},expression:"createOrder.status"}},e._l(e.orderStatusOptions,function(e){return r("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"总价格",prop:"totlaPrice"}},[r("el-input",{attrs:{placeholder:"Please input"},model:{value:e.createOrder.totlaPrice,callback:function(t){e.$set(e.createOrder,"totlaPrice",t)},expression:"createOrder.totlaPrice"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"description"}},[r("el-input",{staticStyle:{width:"385px"},attrs:{type:"textarea",rows:1,placeholder:"Please input"},model:{value:e.createOrder.description,callback:function(t){e.$set(e.createOrder,"description",t)},expression:"createOrder.description"}})],1)],1)]),e._v(" "),r("div",{staticStyle:{color:"red","font-size":"13px"}},[e._v("*商品请在产品管理页面进行选择，商品地址需要带http|https")]),e._v(" "),r("el-table",{key:"1",staticStyle:{width:"100%"},attrs:{data:e.orderItems,border:"",fit:"","highlight-current-row":""}},[r("el-table-column",{attrs:{align:"left",label:"产品分类 产品名称 规格 材质 外观",width:"420"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("img",{staticStyle:{width:"60px",height:"60px"},attrs:{src:e.getFileUrl(t.row.imgUrl)}}),e._v(" "),r("router-link",{attrs:{to:{path:"/screw/productHistory",query:{pid:t.row.productId}}}},[e._v(e._s(e.getProductFullName(t.row)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"参考价格(元)",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e._f("toFixed")(t.row.proposedPrice,2)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"零售价格(元)",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e._f("toFixed")(t.row.retailPrice,2)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"购买数量",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{attrs:{min:1,max:9e7,step:1e4,"controls-position":"right",size:"small",label:"购买数量"},on:{change:function(r){return e.changeBuyCount(t.row,r)}},model:{value:t.row.buyCount,callback:function(r){e.$set(t.row,"buyCount",r)},expression:"scope.row.buyCount"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"总重量(KG)",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{attrs:{min:1,max:1e3,precision:3,step:.001,"controls-position":"right",size:"small",label:"总重量"},model:{value:t.row.buyWeight,callback:function(r){e.$set(t.row,"buyWeight",r)},expression:"scope.row.buyWeight"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"单价(元)",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{attrs:{min:1,max:1e3,precision:2,step:.01,"controls-position":"right",size:"small",label:"单价"},on:{change:function(r){return e.changeRetailPrice(t.row,r)}},model:{value:t.row.retailPrice,callback:function(r){e.$set(t.row,"retailPrice",r)},expression:"scope.row.retailPrice"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"总价(元)",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{attrs:{min:1,max:9e7,precision:2,step:100,"controls-position":"right",size:"small",label:"总价"},model:{value:t.row.buyTotalPrice,callback:function(r){e.$set(t.row,"buyTotalPrice",r)},expression:"scope.row.buyTotalPrice"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"商品地址",width:"360"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{placeholder:"请输入商品地址",clearable:""},model:{value:t.row.buyProductUrl,callback:function(r){e.$set(t.row,"buyProductUrl",r)},expression:"scope.row.buyProductUrl"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:e.$t("table.actions"),"class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",icon:"el-icon-delete",size:"mini"},on:{click:function(r){e.handleRemoveOrderItem(t.row)}}})]}}])})],1),e._v(" "),r("div",{staticStyle:{margin:"30px",float:"right"}},[e.orderItems.length>0?r("el-button",{attrs:{type:"primary"},on:{click:e.addSumbit}},[e._v(e._s(e.$t("table.confirm")))]):e._e(),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.computeTotalPrice}},[e._v("计算总价")]),e._v(" "),r("el-button",{on:{click:e.resetForm}},[e._v(e._s(e.$t("table.reset")))])],1)],1)},staticRenderFns:[]},s=r("VU/8")(l,a,!1,null,null,null);t.default=s.exports}});